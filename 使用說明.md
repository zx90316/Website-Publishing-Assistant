# 網站發布助手使用說明

## 概述

網站發布助手是一個用於自動化網站部署的桌面應用程式，支援定時發布、原子性部署和多伺服器同步發布。

## 功能特色

- 🖥️ **現代化圖形介面** - 使用 tkinter 建構的直觀GUI，無需網頁瀏覽器
- 📁 **靈活的檔案選擇** - 支援選擇多個檔案或資料夾進行發布
- 🗑️ **智能檔案清理** - 可設定發布前自動刪除特定檔案（如伺服器專用配置檔）
- 🌐 **多伺服器部署** - 同時向多個目標伺服器部署
- ⏰ **定時發布** - 設定特定時間自動執行發布，附帶倒數計時顯示
- ⚛️ **原子性部署** - 使用臨時資料夾確保部署過程的完整性和安全性
- 💾 **配置持久化** - 自動儲存所有設定，重啟程式後自動恢復

## 系統需求

- Windows 10/11
- Python 3.7+
- 必要套件：
  - tkinter（通常隨Python安裝）
  - paramiko（SSH連接）
  - json（配置管理）
  - threading（多執行緒支援）

## 安裝說明

### 方法一：直接執行 Python 程式

1. 確保已安裝 Python 3.7 或以上版本
2. 安裝必要套件：
   ```bash
   pip install paramiko
   ```
3. 執行程式：
   ```bash
   python app_clean.py
   ```

### 方法二：打包成 EXE 執行檔

使用 PyInstaller 將程式打包成獨立的執行檔：

1. 安裝 PyInstaller：
   ```bash
   pip install pyinstaller
   ```

2. 打包程式：
   ```bash
   pyinstaller --onefile --windowed --name="網站發布助手" app_clean.py
   ```

3. 打包完成後，在 `dist` 資料夾中會生成 `網站發布助手.exe` 檔案

4. 可選：創建更詳細的打包配置
   ```bash
   pyinstaller --onefile --windowed --name="網站發布助手" --icon=icon.ico --add-data="config.json;." app_clean.py
   ```

## 使用方法

### 1. 基本設定

#### 1.1 設定發行檔案
1. 開啟程式，切換到「設定」頁面
2. 在「目標發行檔案」區域：
   - 點擊「新增檔案」選擇單個檔案
   - 點擊「新增資料夾」選擇整個資料夾
   - 選中項目後點擊「移除」可刪除不需要的項目

#### 1.2 設定需刪除的檔案
1. 在「發布前需刪除的檔案」區域
2. 在文字欄位中輸入檔案名稱（如：`web.config`、`server.log`）
3. 點擊「新增」按鈕
4. 可新增多個檔案，選中後點擊「移除」可刪除

#### 1.3 設定目標伺服器
1. 在「目標伺服器」區域點擊「新增伺服器」
2. 在對話框中填入：
   - **IP地址**：伺服器的IP位址
   - **使用者名稱**：SSH登入使用者名稱
   - **密碼**：SSH登入密碼
   - **目標路徑**：部署到伺服器的目標路徑（如：`/var/www/html`）
3. 點擊「確定」儲存
4. 可新增多個伺服器，選中後點擊「移除」可刪除

### 2. 發布操作

#### 2.1 立即發布
1. 切換到「發布」頁面
2. 確認所有設定正確
3. 點擊「立即發布」按鈕
4. 程式會顯示發布進度和狀態

#### 2.2 定時發布
1. 在「發布」頁面的「定時發布設定」區域
2. 設定發布時間（24小時制）
3. 點擊「設定定時發布」
4. 程式會顯示：
   - 下次發布時間
   - 倒數計時
   - 目標伺服器列表
5. 如需取消，點擊「取消定時」

### 3. 原子性部署流程

程式使用以下步驟確保部署的安全性：

1. **建立臨時資料夾**：在目標路徑建立 `{目標路徑}_TEMP_{時間戳}` 資料夾
2. **上傳新檔案**：將所有發布檔案上傳到臨時資料夾
3. **刪除指定檔案**：移除設定中指定的檔案
4. **備份原資料夾**：將原本的目標資料夾重新命名為備份資料夾
5. **原子性替換**：將臨時資料夾重新命名為目標資料夾
6. **保留伺服器檔案**：將備份中不存在於新版本的檔案複製回來
7. **清理備份**：刪除備份資料夾

這個流程確保：
- 部署過程中服務不會中斷
- 如果部署失敗，原始檔案不會受損
- 伺服器特有的檔案會被保留

## 設定檔說明

程式會自動在執行目錄下建立 `config.json` 檔案，包含所有設定資訊：

```json
{
  "source_files": ["檔案或資料夾路徑列表"],
  "delete_files": ["需要刪除的檔案名稱列表"],
  "servers": [
    {
      "ip": "伺服器IP",
      "username": "使用者名稱",
      "password": "密碼",
      "path": "目標路徑"
    }
  ],
  "schedule_time": "定時發布時間（ISO格式）"
}
```

## 注意事項

### 安全性
- 密碼以明文形式儲存在設定檔中，請確保檔案安全性
- 建議使用專用的部署帳號，限制其權限範圍
- 定期更改SSH密碼

### 網路需求
- 確保能夠透過SSH連接到目標伺服器
- 防火牆需要開放SSH端口（通常是22）
- 建議在內網環境下使用

### 檔案權限
- 確保SSH使用者對目標路徑有寫入權限
- 如果目標路徑不存在，程式會嘗試建立

### 測試建議
- 首次使用前，建議在測試環境中驗證功能
- 可以使用程式提供的測試功能驗證部署邏輯
- 重要的生產環境部署前，建議先進行完整備份

## 疑難排解

### 常見問題

1. **SSH連接失敗**
   - 檢查IP地址、使用者名稱和密碼
   - 確認SSH服務已啟動
   - 檢查防火牆設定

2. **檔案上傳失敗**
   - 檢查目標路徑權限
   - 確認磁碟空間充足
   - 檢查檔案是否被其他程序佔用

3. **定時發布不執行**
   - 確認電腦在設定時間仍在運行
   - 檢查系統時間是否正確
   - 查看程式是否意外關閉

4. **GUI介面異常**
   - 重新啟動程式
   - 檢查Python和tkinter版本
   - 刪除config.json重新設定

### 錯誤日誌

程式運行時的錯誤會顯示在狀態列中，如需詳細診斷，可以從命令列執行程式查看完整錯誤資訊。

## 版本資訊

- **版本**：1.0.0
- **最後更新**：2025年1月
- **支援平台**：Windows
- **開發語言**：Python 3.7+

## 技術支援

如遇到問題或需要功能改進，請聯絡開發團隊或參考原始碼進行自訂修改。

---

**警告**：本程式涉及伺服器檔案操作，使用前請務必在測試環境中驗證功能，並確保有適當的備份措施。